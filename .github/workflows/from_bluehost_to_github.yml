name: from_bluehost_to_github

on:
  schedule:
    # * is a special character in YAML so you have to quote this string
    - cron:  '*/30 * * * *'
  workflow_dispatch:
    # inputs:
    #   debug_enabled:
    #     type: boolean
    #     description: 'Run the build with tmate debugging enabled (https://github.com/marketplace/actions/debugging-with-tmate)'
    #     required: false
    #     default: false


jobs:
  from_bluehost_to_github:
    runs-on: ubuntu-latest
    env:
      BLUEHOST_USERNAME: ${{ secrets.BLUEHOST_USERNAME }}
      BLUEHOST_PASSWORD: ${{ secrets.BLUEHOST_PASSWORD }}
    steps:
      - name: Set up environment
        run: |
             git config --global user.email robert.lugg@gmail.com
             git config --global user.name robertlugg
             
             sudo apt install -y expect        

      - name: Clone campbellluggblackwell.com from github to ./source
        run: |
             echo "GITHUB_REF = $GITHUB_REF"
             git clone --single-branch --branch main https://${{ secrets.API_TOKEN_GITHUB }}@github.com/campbellluggblackwell/campbellluggblackwell.com.git main
             git clone --single-branch --branch incoming https://${{ secrets.API_TOKEN_GITHUB }}@github.com/campbellluggblackwell/campbellluggblackwell.com.git incoming
          
      - name: Setup tmate session (if debug was enabled)
        uses: mxschmitt/action-tmate@v3
        if: ${{ github.event_name == 'workflow_dispatch' && inputs.debug_enabled }}
        
      - name: Get Bluehost files
        timeout-minutes: 10
        run: |
            ls
            chmod +x main/.github/workflows/rsync_expect_script
            main/.github/workflows/rsync_expect_script $BLUEHOST_USERNAME $BLUEHOST_PASSWORD
            # Cleanup
            rm -Rf ./main
            cd ./incoming/website/
            rm -Rf *.bak
            rm -Rf .htaccess
            rm -Rf .ftp*
            

      - name: Commit and push bluehost files to github
        run: |
            cd ./incoming/website/
            git status
            git add --all
            git commit -am "Automatic upload from action from_bluehost_to_github.yml"
            git push || true
            

            

      
